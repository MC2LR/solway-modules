
<template>
  <div class="svg-img">
    <section-e :data="data"></section-e>
    <section-f></section-f>
    <svg ref="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 787 416">
        <defs>
            <image id="image" width="365" height="365"
                xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW4AAAFuCAYAAAChovKPAAAACXBIWXMAAAsSAAALEgHS3X78AAAFHklEQVR4Xu3UsQ0AIAzAMOD/n8sJrESy58zZM7MA6DivAIC/GDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8QYN0CMcQPEGDdAjHEDxBg3QIxxA8Rcre8F2YrOZY0AAAAASUVORK5CYII=" />
            <image id="image-2" width="364" height="365"
                xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAW0AAAFuCAYAAABKlUmMAAAACXBIWXMAAAsSAAALEgHS3X78AAAFHklEQVR4Xu3UsQ0AIAzAMOD/n8sJrESy58zZM7MAaDivAIB/mDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4SYNkCIaQOEmDZAiGkDhJg2QIhpA4RcYtgF2RhJBjMAAAAASUVORK5CYII=" />
        </defs>
        <g class="cls-1">
            <polygon class="cls-2" points="312.83 47.48 36 205 373.5 403.5 656.24 240.84 312.83 47.48" />
            <path class="cls-3"
                d="M373.49,404.66,34,205l1.51-.86L312.82,46.33l.5.28L658.26,240.83l-1.52.88ZM38,205,373.51,402.34,654.22,240.85,312.83,48.63Z" />
        </g>
        <g class="cls-4">
            <polygon class="cls-5" points="284.83 21.34 284.3 107.68 264.95 229.49 265.48 143.16 284.83 21.34" />
            <path class="cls-6"
                d="M266.43,229.73l-3-.24L264,143l0-.12L283.35,21.11l3,.24-.53,86.45v.11Zm.55-86.45-.41,66.45L282.8,107.55l.41-66.45Z" />
        </g>
        <g class="cls-4">
            <polygon class="cls-5" points="260.22 234.76 259.69 321.09 177.52 258.56 178.05 172.23 260.22 234.76" />
            <path class="cls-6"
                d="M261.18,324.11,176,259.3l.54-90.08L261.73,234ZM179,257.82l79.19,60.26.51-82.58-79.19-60.26Z" />
        </g>
        <polyline class="cls-5" points="264.95 229.49 313.85 267.21 476.25 284.15" />
        <polygon class="cls-6"
            points="476.1 285.64 313.27 268.66 264.04 230.68 265.87 228.31 314.43 265.76 476.4 282.66 476.1 285.64" />
        <g class="cls-4">
            <polygon class="cls-5" points="476.78 197.81 476.25 284.15 468.51 336.61 469.04 250.27 476.78 197.81" />
            <path class="cls-6"
                d="M470,336.83l-3-.23.53-86.44v-.11l7.74-52.46,3,.23-.53,86.44,0,.11Zm.55-86.44-.4,64.89L474.75,284l.4-64.89Z" />
        </g>
        <g class="cls-4">
            <polygon class="cls-5" points="469.04 250.27 468.51 336.61 259.69 321.09 260.22 234.76 469.04 250.27" />
            <path class="cls-6"
                d="M470,338.22,258.19,322.48l.54-89.34,211.81,15.74ZM261.2,319.7,467,335l.51-83.33L261.71,236.37Z" />
        </g>
        <polyline class="cls-5" points="200.27 16.15 200.27 106.76 177.52 258.56" />
        <polygon class="cls-6"
            points="179 258.79 176.04 258.34 198.77 106.64 198.77 16.15 201.77 16.15 201.77 106.87 201.76 106.98 179 258.79" />
        <line class="cls-5" x1="200.27" y1="106.76" x2="283.39" y2="113.42" />
        <rect class="cls-6" x="240.33" y="68.4" width="3" height="83.38"
            transform="translate(112.75 342.34) rotate(-85.41)" />
        <rect class="cls-6" x="312.35" y="184.29" width="3" height="82.92" />
        <polygon class="cls-7" points="460.81 289.07 459.81 310.99 454.62 325.22 455.62 303.29 460.81 289.07" />
        <polygon class="cls-8" points="454.62 325.22 394.7 320.62 395.69 298.69 455.62 303.29 454.62 325.22" />
        <polygon class="cls-9" points="455.62 303.29 395.69 298.69 400.88 284.46 460.81 289.07 455.62 303.29" />
        <polygon class="cls-7" points="257.96 119.45 257.09 138.58 252.56 150.99 253.43 131.86 257.96 119.45" />
        <polygon class="cls-10" points="252.56 150.99 200.27 146.98 201.14 127.85 253.43 131.86 252.56 150.99" />
        <polygon class="cls-11" points="253.43 131.86 201.14 127.85 205.67 115.43 257.96 119.45 253.43 131.86" />
        <polygon class="cls-7" points="253.43 158.46 252.56 177.59 248.03 190.01 248.9 170.88 253.43 158.46" />
        <polygon class="cls-10" points="248.03 190.01 195.74 185.99 196.61 166.86 248.9 170.88 248.03 190.01" />
        <polygon class="cls-11" points="248.9 170.88 196.61 166.86 201.14 154.45 253.43 158.46 248.9 170.88" />
        <g class="cls-1">
            <polygon class="cls-5"
                points="284.83 21.34 265.48 143.16 313.85 184.29 476.78 197.81 469.04 250.27 260.22 234.76 178.05 172.23 200.27 16.15 284.83 21.34" />
            <path class="cls-6"
                d="M470.32,251.87,259.67,236.22l-.36-.27-82.87-63.06.12-.87L199,14.57,286.57,20,267.09,142.56l47.36,40.28,164,13.61ZM260.78,233.29l207,15.38,7.3-49.49L313.24,185.75l-49.38-42,19.23-121-81.53-5-21.9,153.84Z" />
        </g>
        <polygon class="cls-12"
            points="408 375.15 14.47 375.15 14.47 351.15 15.47 351.15 15.47 374.15 407 374.15 407 314 408 314 408 375.15" />
        <use transform="translate(-167.19 169.46)" xlink:href="#image" />
        <circle ref="position3" class="cls-12" cx="14.97" cy="351.65" r="2" />
        <use transform="translate(-166.49 -68.76)" xlink:href="#image" />
        <circle ref="position7" class="cls-12" cx="15.67" cy="113.42" r="2" />
        <use transform="translate(27.84 -5.52)" xlink:href="#image" />
        <circle class="cls-12" cx="210" cy="176.67" r="2" />
        <use transform="translate(67 -37)" xlink:href="#image-2" />
        <circle class="cls-12" cx="249" cy="145.67" r="2" />
        <use transform="translate(593 -53)" xlink:href="#image-2" />
        <circle ref="position8" class="cls-12" cx="775" cy="129.67" r="2" />
        <use transform="translate(224.53 130)" xlink:href="#image" />
        <circle class="cls-12" cx="407.5" cy="312.65" r="2" />
        <polygon class="cls-12"
            points="210 177.17 15.17 177.17 15.17 113.42 16.17 113.42 16.17 176.17 210 176.17 210 177.17" />
        <polygon class="cls-12"
            points="776 146.55 248.03 146.55 248.03 145.55 775 145.55 775 130.86 776 130.86 776 146.55" />
    </svg>
  </div>
</template>

<script>
export default {
    props: ['data'],
    data () {
        return {}
    },
    mounted () {
        this.$emit('hasDevice', {
            d3: true,
            d7: true,
            d8: true
        })
        this.timer1 = setTimeout(() => {
            this.$el.className += ' loaded'
            this.$refs.svg.style.transform = 'translateY(0)'
        }, 300)
        this.timer2 = setTimeout(this.getXY, 1000)
        window.addEventListener('resize', this.getXY)
    },
    methods: {
        async getXY (event) {
            const {
                position3,
                position7,
                position8
            } = this.$refs
            const positions = {
                p3: this.getLeftTop(position3.getBoundingClientRect()),
                p7: this.getLeftTop(position7.getBoundingClientRect()),
                p8: this.getLeftTop(position8.getBoundingClientRect())
            }
            if (event) this.$emit('loadedAndRander', positions)
            const {p3, p7, p8} = positions
            this.$emit('loadedAndRander', { p7 })
            await this.$timeout(200)
            this.$emit('loadedAndRander', { p3 })
            await this.$timeout(200)
            this.$emit('loadedAndRander', { p8 })
        },
        getLeftTop (o) {
            return {
                left: o.left,
                top: o.top + o.width / 2
            }
        }
    },
    beforeDestroy () {
        clearTimeout(this.timer1)
        clearTimeout(this.timer2)
        window.removeEventListener('resize', this.getXY)
    },
    components: {
        SectionE: () => import('../section/SectionE'),
        SectionF: () => import('../section/SectionF')
    }
}
</script>

<style lang="scss">
.section-f .home-item {
    width: 1.5rem;
}
</style>

<style lang="scss" scoped>
.svg-img {
  width: 100%;
  height: 100%;
  padding-top: 0.6rem;
  padding-bottom: 0.3rem;
  padding-left: 1.8rem;
  padding-right: 0.3rem;
  position: relative;

    &.loaded .section-e, &.loaded .section-f {
        opacity: 1;
    }

    svg {
        background: url(./grid.png) no-repeat center;
        background-size: cover;
        width: 100%;
        height: 100%;
        transform: translateY(150%);
        transition: all 0.3s ease;
    }

    .section-e {
        position: absolute;
        left: 3.2rem;
        top: 0.3rem;
        opacity: 0;
        transition: all 1s ease .5s;
        z-index: 2;
    }

    .section-f {
        position: absolute;
        width: 3rem;
        right: -0.6rem;
        bottom: 1rem;
        opacity: 0;
        transition: all 1s ease 1s;
        z-index: 2;
    }

    .cls-1 {
        opacity: 0.6;
    }

    .cls-2 {
        fill: #06131e;
    }

    .cls-3 {
        fill: #2097a4;
    }

    .cls-4 {
        opacity: 0.8;
    }

    .cls-5 {
        fill: #103646;
    }

    .cls-6 {
        fill: #22b8ff;
    }

    .cls-7 {
        fill: #215e85;
    }

    .cls-8 {
        fill: #3f9bcf;
    }

    .cls-9 {
        fill: #276d9b;
    }

    .cls-10 {
        fill: #56beed;
    }

    .cls-11 {
        fill: #3889b8;
    }

    .cls-12 {
        fill: #00b4b5;
    }
}
</style>
